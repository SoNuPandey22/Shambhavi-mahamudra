<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shambhavi Mahamudra</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      min-width: 100vw;
      box-sizing: border-box;
      background: url('resources/guruimage.jpg') no-repeat center center fixed;
      background-size: cover;
      background-position: center center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      /* fallback color */
      background-color: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'Segoe UI', Arial, sans-serif;
    }
    .container {
      background: rgba(255,255,255,0); /* fully transparent */
      border-radius: 16px;
      padding: 2rem 3rem;
      box-shadow: 0 4px 32px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      align-items: center;
      border: none;
    }
    h1 {
      margin-bottom: 2rem;
      font-size: 2.2rem;
      letter-spacing: 1px;
      color: #333;
      text-align: center;
    }
    #startBtn {
      padding: 1rem 2.5rem;
      font-size: 1.3rem;
      border: none;
      border-radius: 8px;
      background: #4a90e2;
      color: #fff;
      cursor: pointer;
      transition: background 0.2s;
      margin-bottom: 1.5rem;
    }
    #startBtn:active {
      background: #357ab8;
    }
    #timer {
      font-size: 2rem;
      margin-bottom: 1rem;
      color: #222;
      letter-spacing: 2px;
    }
    #status {
      font-size: 1.1rem;
      color: #555;
      min-height: 1.5em;
      text-align: center;
    }
    @media (max-width: 600px) {
      body {
        background-size: cover;
        background-position: center center;
        background-repeat: no-repeat;
        background-attachment: scroll;
      }
      .container {
        padding: 1rem 0.5rem;
      }
      h1 {
        font-size: 1.3rem;
      }
      #timer {
        font-size: 1.2rem;
      }
      #startBtn {
        font-size: 1rem;
        padding: 0.7rem 1.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Shambhavi Mahamudra</h1>
    <button id="startBtn">Start</button>
    <div id="timer">21:00</div>
    <div id="status"></div>
  </div>
  <!-- Dummy ping sound -->
  <audio id="pingSound" src="resources/ping-82822.mp3" preload="auto"></audio> <!-- Add ping.mp3 to resources folder -->
  <!-- Meditation audio (replace with your own file in resources) -->
  <audio id="meditationAudio" src="resources/deep-aum-om-meditation-chanting-aum-21-times-sadhguru_WXHtVcIG.mp3" preload="auto"></audio>
  <!-- Mantra audio to play after session completion -->
  <audio id="mantraAudio" src="resources/kaalo-na-jaanaati-.mp3" preload="auto"></audio>
  <script>
    const startBtn = document.getElementById('startBtn');
    const timerEl = document.getElementById('timer');
    const statusEl = document.getElementById('status');
    const pingSound = document.getElementById('pingSound');
    const meditationAudio = document.getElementById('meditationAudio');
    const mantraAudio = document.getElementById('mantraAudio');

    let interval = null;
    let startTime = null;
    let wakeLock = null;
    let programState = 0;
    // 0: not started, 1: running, 2: finished

    // Time points in seconds
    const TOTAL_DURATION = 21 * 60; // 21 min
    const AUDIO_START = 6 * 60; // 6 min
    const AUDIO_DURATION = 6 * 60 + 12; // 6 min 12 sec
    const SILENCE_AFTER_AUDIO = 4 * 60; // 4 min
    const SECOND_PING = AUDIO_START + AUDIO_DURATION + SILENCE_AFTER_AUDIO; // 16:12

    function formatTime(secs) {
      const m = Math.floor(secs / 60).toString().padStart(2, '0');
      const s = Math.floor(secs % 60).toString().padStart(2, '0');
      return `${m}:${s}`;
    }

    async function requestWakeLock() {
      if ('wakeLock' in navigator) {
        try {
          wakeLock = await navigator.wakeLock.request('screen');
        } catch (err) {
          // fallback: show message
          statusEl.textContent = 'Screen wake lock not available.';
        }
      } else {
        statusEl.textContent = 'Screen wake lock not supported in this browser.';
      }
    }

    function playPing() {
      pingSound.currentTime = 0;
      pingSound.play();
    }

    function startProgram() {
      if (programState !== 0) return;
      programState = 1;
      startBtn.disabled = true;
      statusEl.textContent = 'Sukha kriya...';
      let elapsed = 0;
      timerEl.textContent = formatTime(TOTAL_DURATION);
      playPing(); // Initial ping
      requestWakeLock();
      meditationAudio.pause();
      meditationAudio.currentTime = 0;
      let audioStarted = false;
      let audioEnded = false;
      let secondPingDone = false;
      startTime = Date.now();
      interval = setInterval(() => {
        elapsed = Math.floor((Date.now() - startTime) / 1000);
        let remaining = TOTAL_DURATION - elapsed;
        if (remaining < 0) remaining = 0;
        timerEl.textContent = formatTime(remaining);

        // At 6:00, start audio
        if (!audioStarted && elapsed >= AUDIO_START) {
          meditationAudio.play();
          statusEl.textContent = 'Aum Chanting.';
          audioStarted = true;
        }
        // At 12:12, stop audio, start silence
        if (audioStarted && !audioEnded && elapsed >= AUDIO_START + AUDIO_DURATION) {
          meditationAudio.pause();
          statusEl.textContent = 'Viparit Swasana - continue in silence.';
          audioEnded = true;
        }
        // At 16:12, ping again
        if (!secondPingDone && elapsed >= SECOND_PING) {
          playPing();
          statusEl.textContent = 'Continue in silence until the end.';
          secondPingDone = true;
        }
        // At 21:00, finish
        if (elapsed >= TOTAL_DURATION) {
          clearInterval(interval);
          programState = 2;
          statusEl.textContent = 'Session complete. Namaste!';
          timerEl.textContent = '00:00';
          startBtn.disabled = false;
          if (wakeLock) {
            wakeLock.release();
            wakeLock = null;
          }
          // Play mantra audio after session completion
          mantraAudio.currentTime = 0;
          mantraAudio.play();
        }
      }, 500);
    }

    startBtn.addEventListener('click', startProgram);
  </script>
</body>
</html> 
